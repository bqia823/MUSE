<body>
    <link href="https://fonts.googleapis.com/css?family=Italiana&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./css/creat_account.css" />


    <div class="container">
        {{#if toastMessage}}
        <p>{{toastMessage}}</p>
        {{/if}}

        <div class="frame"></div>
        <div class="pannel">
            <div class="pannelshadow"></div>
            <form action="/create_account" method="POST">

                <button type="submit" class="submitbtn">Submit</button>

                <div class="iconcontainer">
                    <div class="icon1" data-icon="boy1.png"></div>
                    <div class="icon2" data-icon="boy2.png"></div>
                    <div class="icon3" data-icon="boy3.png"></div>
                    <div class="icon4" data-icon="boy4.png"></div>
                    <div class="icon5" data-icon="girl1.png"></div>
                    <div class="icon6" data-icon="girl2.png"></div>
                    <div class="icon7" data-icon="girl3.png"></div>
                    <div class="icon8" data-icon="girl4.png"></div>
                    <div class="icon9" data-icon="girl5.png"></div>
                    <input type="hidden" id="icon" name="icon" value="">
                </div>
                <span class="chooseicon">Please choose your icon</span>

                <input type="text" name="Brief_Description" class="descriptiontext"
                    placeholder="Please describe yourself in 50 words" value="{{userProfile.Brief_Description}}">
                <span class="description">Description</span>

                <input type="password" name="repassword" class="confirmpasswordtext"
                    placeholder="Please confirm your password">
                <span class="confirmpassword">Confirm Password</span>
                <div class="passwordAvailability" id="passwordAvailability"></div>

                <input type="password" name="password" class="passwordtext" placeholder="Please enter your password">
                <span class="password">Password</span>

                <input type="date" name="birthdate" class="birthdatetext" placeholder="DD/MM/YYYY"
                    value="{{userProfile.Date_Of_Birth}}">
                <span class="birthdate">Birth date</span>

                <input type="text" name="idname" class="idnametext" placeholder="Please enter your real name"
                    value="{{userProfile.Real_Name}}">
                <span class="idname">Real Name</span>

                <form id="createAccountForm">
                    <input type="text" name="username" class="usernametext" placeholder="Please enter your username"
                        value="{{userProfile.Username}}">
                    <span class="username">Username</span>
                    <div class="usernameAvailability" id="usernameAvailability"></div>
                </form>

            </form>

            <a href="http://localhost:3000/user_login"><span class="haveaccount">Already have an account.</span></a>
            <span class="creataccount">Create Account</span>
            <div class="logo"></div>

        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.iconcontainer div').on('click', function () {
                $('.iconcontainer div').css('outline', ''); // 取消所有图标的突出显示
                $(this).css('outline', '2px solid red'); // 突出显示选中的图标
                $('#icon').val($(this).attr('data-icon')); // 更新隐藏的输入字段的值
            });
        });

        document.querySelector("input[name='username']").addEventListener("input", function () {
            const username = this.value;
            if (!username.trim()) { // 如果用户名为空或者只有空白字符
                document.getElementById("usernameAvailability").textContent = '';
            } else {
                fetch(`/check_username/${username}`)
                    .then(response => response.text())
                    .then(message => {
                        if (username.length < 3 || username.length > 10) {
                            document.getElementById("usernameAvailability").textContent = 'Please limit username to 3-10 characters';
                        } else {
                            document.getElementById("usernameAvailability").textContent = message;
                        }
                    });
            }
        });

        const passwordInput = document.querySelector("input[name='password']");
        const repasswordInput = document.querySelector("input[name='repassword']");
        const passwordHint = document.getElementById("passwordAvailability");

        function checkPasswordConsistency() {
            if (passwordInput.value !== repasswordInput.value) {
                passwordHint.textContent = 'Passwords do not match!';
                passwordHint.style.color = 'red';
            } else {
                passwordHint.textContent = '';
            }
        }

        // Listen for the blur event on the repassword input field
        repasswordInput.addEventListener('blur', checkPasswordConsistency);


    </script>
</body>